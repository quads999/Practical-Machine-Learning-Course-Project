---
title: "Practical Machine Learning Course Project Writeup"
author: "John S."
date: "1/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Background

Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible to collect a large amount of data about personal activity relatively inexpensively. These type of devices are part of the quantified self movement â€“ a group of enthusiasts who take measurements about themselves regularly to improve their health, to find patterns in their behavior, or because they are tech geeks. One thing that people regularly do is quantify how much of a particular activity they do, but they rarely quantify how well they do it. In this project, the goal will be to use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants. They were asked to perform barbell lifts correctly and incorrectly in 5 different ways. More information is available from the website here: <http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har> (see the section on the Weight Lifting Exercise Dataset).

### Data

The training data for this project are available here:

<https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv>

The test data are available here:

<https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv>

The data for this project come from this source:

<http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har>

### Project Objective

The goal of this project is to predict the manner in which subjects performed their exercise.

### Workspace Setup

```{r}
#set working directory
setwd('C:/Users/johnr/OneDrive/Documents/CourseraFiles/course7/Project')

#load packages
require(caret); require(rpart); require(randomForest)

#set seed for reproduceability of results
set.seed(76)
```

### Data Preparation

```{r}
#identify source of experiment data
data_source <- 'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv'

#download experiment data file
download.file(data_source, 'data.csv')

#import data from file and identify invalid values as NA
data <- read.csv('data.csv',  na.strings=c('NA','#DIV/0!', ''))

#remove rows with NA values
data <- data[,colSums(is.na(data)) == 0]

#remove first 7 columns which are not needed for training the models
data <- data[,-c(1:7)]
```

### Cross Validation
I performed cross validation by partitioning 75% of the expermient data by random sampling into a training set that will be used to construct the model, and then use the remaining 25% to test the model and analyze its performance.

```{r}
#split the data into train and test sets
split <- createDataPartition(data$classe, p=0.7, list=FALSE)
train <- data[split,]
test <- data[-split,]
```

### Model Construction and Predictions
Since the outcome variable ("classe") is categorical, I choose to first build and test a decision tree model.

The model will be built to predict any of the following outcomes:

A - excercise performed exactly correct
B - throwing the elbows to the front
C - lifting the dumbbell only halfway
D - lowering the dumbbell only halfway
E - throwing the hips to the front

When building a model, it is useful to first explore and sometimes visualize data if possible to determine if there are any obvious variables or factors that would be meaningful in the model. Below we plot several variables together in their x and y coordinates in order to see if there are any discernible patterns.


```{r}
#generate plot of x and y coordinate values of the accelerometer associated with the dumbell
qplot(accel_dumbbell_x, accel_dumbbell_y, col=classe, data=train)

#generate plot of x and y coordinate values of the accelerometer associated with the dumbell
qplot(accel_belt_x, accel_belt_y, col=classe, data=train)
```

Because plots like the one above do not show any clear patterns in the data, we will proceed to write code  to build a model to predict "classe" using a combination of up to the remaining 53 possible explanatory variables; and then use that model to make predictions based on the test dataset.

```{r}
#train a decision tree model using the training dataset
DecisionTreeModel <- rpart(classe ~ ., train, method = 'class')

#determine predictions with the decision treem model using the test dataset
DecisionTreePred <- predict(DecisionTreeModel, test, type = 'class')
```

In order to make the most accurate predictions possible, I also develop and test a more advanced type of classification model - a random forest model, which consists of many individual decision trees.

```{r}
#train a random forest model using the training dataset
RandomForestModel <- randomForest(classe ~ ., train, method = 'class')

#determine predictions using the test dataset
RandomForestPred <- predict(RandomForestModel, test, type = 'class')
```

### Model Performance Analysis
Next, I calculated confusion matricies for each model to analyze their performance and accuracy.

```{r}
#construct confusion matricies
DT_CM <- confusionMatrix(DecisionTreePred, test$classe)
RF_CM <- confusionMatrix(RandomForestPred, test$classe)

#print the decision tree model confusion matrix
DT_CM$table
#print the decision tree model accuracy
DT_CM$overall[1]

#print the random forest model confusion matrix
RF_CM$table
#print the random forest model accuracy
RF_CM$overall[1]
```

### Out of Sample Error
The  out of sample error is 1 minus accuracy in the test dataset. For the random forest model it would therefore be 1 - 0.994 = 0.6%

### Model Selection

Given that the Random Forest Model is highly more accurate (99.4%) than the Decision Tree Model, then we select the Random Forest Model to use as our final model.

### Final Model Evaluation

Next, I evaluated my model by making predictions from the additional provided dataset containing 20 records for the final test.

```{r}
test_source <- 'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv'

download.file(test_source, 'final_test.csv')

final_test <- read.csv("test.csv")

predict(RandomForestModel, final_test, type = 'class')
```

